<!DOCTYPE html>
<html lang="es">

<head>
 <meta charset="UTF-8">
 <meta name="viewport"
   content="width=device-width">
  <!-- General Styles -->
  <link rel="stylesheet" href="./css/style.css">

  <!-- Link hacia el archivo de estilos css -->
  <link rel="stylesheet" type="text/css" href="css/estilos.css">
 <title>Iniciar sesión</title>
 <script type="module"
   src="./js/custom/mi-nav.js">
   </script>
</head>

<body>
  <header>
   <mi-nav id="nav"></mi-nav>
  </header>
 </indicador-cargando>
  <div id="contenedor">

      <div id="contenedorcentrado">
          <div id="loge">
              <form id="login">
                  <label for="usuario">Usuario</label>
                  <input id="usuario" type="text" name="cue" placeholder="Usuario">

                  <label for="password">Contraseña</label>
                  <input id="password" type="password" placeholder="Contraseña" name="match">

                  <button>Iniciar sesión</button>
              </form>

          </div>
          <div id="derecho">
              <div class="titulo">
                  Bienvenido
              </div>
              <hr>
              <div class="pie-form">
                  <a>¿Perdiste tu contraseña?</a>
                  <a href="#">Envia un mensaje al Administrador</a>
                  <hr>
                  <a href="#">« Volver</a>
              </div>
          </div>
      </div>
  </div>
 <script type="module">
  import {
   ejecuta
  } from "./lib/js/ejecuta.js"
  import {
   muestraError
  } from "./lib/js/muestraError.js"
  import {
   submit
  } from "./lib/js/submit.js"
  import {
   Sesion
  } from "./js/Sesion.js"

  preparaVista()

  async function preparaVista() {
   try {
    const json =
     await buscaEnElServidor()
    const sesion = new Sesion(json)
    muestra(sesion)
   } catch (e) {
    muestraError(e)
   }
  }

  async function
   buscaEnElServidor() {
   return await ejecuta(fetch(
    "srv/SrvSesion.php"))
  }

  function muestra(sesion) {
   if (sesion.cue === "") {
    nav.sesion = sesion
    login.hidden = false
    escuchaEventos()
   } else {
    saltaAPerfil()
   }
  }

  function escuchaEventos() {
   login.addEventListener("submit",
    iniciaSesion)
  }

  function saltaAPerfil() {
   location.href = "perfil.html"
  }

  /** @param {Event} evt */
  export
   async function iniciaSesion(
    evt) {
   try {
    evt.preventDefault()
    const json = await submit(evt,
     "srv/SrvLogin.php", login)
    saltaAPerfil()
   } catch (e) {
    muestraError(e)
   }
  }
 </script>
  <!-- MDBootstrap V5 -->
  <script src="./js/mdb.min.js" ></script>

  <!-- General scripts -->
  <script src="./js/main.js" ></script>
  <script src="./js/nav.js" ></script>
</body>

</html>